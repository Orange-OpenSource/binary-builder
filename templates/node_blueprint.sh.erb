#!/usr/bin/env bash
set -e

INSTALLATION_DIR=$1
NODE_DIR=$INSTALLATION_DIR/node-<%= binary_version %>-linux-x64

curl http://nodejs.org/dist/<%= binary_version %>/node-<%= binary_version %>.tar.gz -s --fail -o - | tar xzf - 2>/dev/null

cd node-<%= binary_version %>

if [[ `lsb_release -r` == *10.04* ]]; then
  ./configure --shared-openssl-libpath=/lib/ --prefix=/
elif [[ `lsb_release -r` == *14.04* ]]; then
  ./configure --shared-openssl --prefix=/
fi

make -j 3 install DESTDIR=$NODE_DIR PORTABLE=1
cp LICENSE $NODE_DIR
